/*
 * A responsive thumbnail that updates based on a scrollable image's position. Interacting with the thumbnail
 * also (optionally) scrolls the image.
 *
 * author: Bremen Braun (konapun), 2013 for FlyExpress (http://www.flyexpress.net/)
 */
(function(e){e.fn.activeThumbnail=function(t){var n=e(this),r=e.extend({image:n.attr("data-image"),width:100,height:100,color:"red",container:"",clickEnabled:true},t);var i=e("#"+r.image),s=r.container?e("#"+r.container):e(i.parent()),o=new Image,u=e("<div></div>"),a=function(){var t=e(o).offset(),n=s.scrollLeft()/i.width()*r.width,a=s.scrollTop()/i.height()*r.height;u.offset({top:t.top+a-1,left:t.left+n-1})};u.update=function(){var t=e(o),n=t.width(),r=t.height(),a=s.width()/i.width()*n,f=s.height()/i.height()*r;u.css({width:a>n?n:a,height:f>r?r:f})};u.getThumbnail=function(){return o};o.onload=function(){var t=e(this);n.css("position","relative");t.css({width:r.width,height:r.height});u.css({position:"absolute",border:"1px solid "+r.color}).update();n.append(u);n.append(o);a()};var f=i.get(0),l=function(){o.src=i.prop("src")};f.onload=l;if(f.complete){l()}s.scroll(function(e){a()});if(r.clickEnabled){e(o).click(function(t){var n=e(o).offset(),u=t.pageX-n.left,a=t.pageY-n.top;s.scrollLeft(u*r.width/2*s.width()/i.width());s.scrollTop(a*r.height/2*s.height()/i.height())})}return u}})(jQuery)